<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top 1000 PC Games | Free Download</title>

    <!-- Default SEO Meta Tags (Updated Dynamically) -->
    <meta name="description" content="Find and download the best 1000 PC games. Get trending RPGs, battle royale, and strategy games.">
    <meta name="keywords" content="best PC games, free game download, RPG games, strategy games, battle royale, FPS games">
    <meta name="author" content="1337Xtreme">
    <meta name="robots" content="index, follow">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Top 1000 PC Games | Free Download">
    <meta property="og:description" content="Find the top 1000 PC games with official store links.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-site.com/top-1000-pc-games">
    <meta property="og:image" content="https://your-site.com/game-thumbnail.jpg">

    <!-- Load API Key -->
    <script src="games.js"></script>

    <!-- Preload Empty Schema for Google -->
    <script type="application/ld+json" id="schema-data">
    {
        "@context": "https://schema.org",
        "@type": "ItemList",
        "name": "Top 1000 PC Games",
        "itemListElement": []
    }
    </script>

</head>
<body>

    <h1>Top 1000 PC Games</h1>

    <table class="game-table">
        <thead>
            <tr>
                <th>#</th>
                <th>Game Name</th>
            </tr>
        </thead>
        <tbody id="game-list"></tbody>
    </table>

    <div class="pagination" id="pagination"></div>

    <script>
        let urlParams = new URLSearchParams(window.location.search);
        let currentPage = parseInt(urlParams.get("page")) || 1;
        const gamesPerPage = 50;
        let allGames = [];

        async function fetchAllGames() {
            document.getElementById("game-list").innerHTML = "<tr><td colspan='2'>Loading games...</td></tr>";

            if (typeof config === "undefined" || !config.API_KEY) {
                console.error("❌ API key is missing or games.js is not loaded.");
                return;
            }

            let apiUrl = `https://api.rawg.io/api/games?key=${config.API_KEY}&page_size=50&platforms=4`;

            try {
                allGames = [];
                let positionCounter = 1;

                for (let i = 1; i <= 20; i++) {  // Fetching 20 pages (1000 games)
                    let response = await fetch(apiUrl + "&page=" + i);
                    if (!response.ok) throw new Error(`❌ HTTP error! Status: ${response.status}`);
                    let data = await response.json();
                    if (!data.results) throw new Error("❌ No game data found.");

                    for (let game of data.results) {
                        let gameUrl = await getGameStoreUrl(game.id);
                        allGames.push({ 
                            position: positionCounter, 
                            name: game.name, 
                            url: gameUrl 
                        });
                        positionCounter++;
                    }
                }

                console.log("✅ Games Loaded:", allGames.length, "games.");

                displayGames();
                createPagination();
                injectStaticSchema();
            } catch (error) {
                console.error("❌ Game Fetch Error:", error);
                document.getElementById("game-list").innerHTML = "<tr><td colspan='2'>Failed to load games.</td></tr>";
            }
        }

        async function getGameStoreUrl(gameId) {
            let gameDetailsUrl = `https://api.rawg.io/api/games/${gameId}?key=${config.API_KEY}`;
            try {
                let response = await fetch(gameDetailsUrl);
                if (!response.ok) throw new Error(`Error fetching game details: ${response.status}`);
                let gameData = await response.json();
                
                if (gameData.stores && gameData.stores.length > 0) {
                    return gameData.stores[0].url;
                } else {
                    return `https://www.google.com/search?q=${encodeURIComponent(gameData.name + " free download")}`;
                }
            } catch (error) {
                console.error(`Error fetching store URL for game ID ${gameId}:`, error);
                return `https://www.google.com/search?q=${encodeURIComponent(gameData.name + " free download")}`;
            }
        }

        function displayGames() {
            if (allGames.length === 0) {
                console.error("❌ No games available to display.");
                return;
            }

            let start = (currentPage - 1) * gamesPerPage;
            let end = start + gamesPerPage;
            let paginatedGames = allGames.slice(start, end);

            document.getElementById("game-list").innerHTML = paginatedGames.map(game =>
                `<tr><td>${game.position}</td><td><a href="${game.url}" target="_blank">${game.name}</a></td></tr>`
            ).join("");

            console.log("✅ Displaying Games:", paginatedGames.length);

            updateMetaTags(paginatedGames);
        }

        function createPagination() {
            let totalPages = Math.ceil(allGames.length / gamesPerPage);
            document.getElementById("pagination").innerHTML =
                Array.from({ length: totalPages }, (_, i) => `<a href="?page=${i + 1}">${i + 1}</a>`).join(" | ");
        }

        function updateMetaTags(games) {
            if (games.length === 0) return;

            let firstGameName = games[0].name;
            let pageTitle = `${firstGameName} Free Download | Top PC Games`;
            document.title = pageTitle;

            let metaDescription = `Download ${firstGameName} for free! Explore the best trending PC games available now.`;
            let metaKeywords = games.map(game => game.name + " free download").join(", ");

            document.querySelector("meta[name='description']").setAttribute("content", metaDescription);
            document.querySelector("meta[name='keywords']").setAttribute("content", metaKeywords);

            console.log("✅ Meta tags updated:", { title: pageTitle, description: metaDescription, keywords: metaKeywords });
        }

        function injectStaticSchema() {
            let schemaData = {
                "@context": "https://schema.org",
                "@type": "ItemList",
                "name": "Top 1000 PC Games",
                "itemListElement": allGames.map((game, index) => ({
                    "@type": "ListItem",
                    "position": index + 1,
                    "name": game.name,
                    "url": game.url
                }))
            };

            let schemaScript = document.createElement("script");
            schemaScript.type = "application/ld+json";
            schemaScript.textContent = JSON.stringify(schemaData, null, 2);

            let schemaContainer = document.getElementById("schema-data");
            if (schemaContainer) {
                schemaContainer.remove();
            }

            document.head.appendChild(schemaScript);

            console.log("✅ Schema Injected:", schemaData);
        }

        fetchAllGames();
    </script>

</body>
</html>